# Overrides config file for kubelet
# Temporary set pod-max-pids until unlock. During the restore procedure,
# between restore_platform playbook and unlock, there is a window in
# which user app pods can misbehave. Chose a value over the 20, which is
# the number of processes used by platform pods. Chose a value over 100,
# to allow room for platform pods. The user apps are in fact
# intended to run after the unlock anyway. During the unlock the correct
# value is used, the one generated by sysinv as hieradata.
KUBELET_EXTRA_ARGS=\
{%+ if mode|default(none) == 'restore' and restore_mode|default(none) == 'optimized' %}
--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock \
{%+ endif %}
--node-ip={{ node_ip }} \
--volume-plugin-dir={{ kubelet_vol_plugin_dir }} \
--pod-max-pids 500
